<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<title>Twig | DrupalCamp Paris 2013</title>
		<meta name="description" content="Présentation de Twig lors du DrupalCamp Paris 2013">
		<meta name="author" content="opi">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/solarized.css" id="theme">
		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
    <!-- Custom -->
    <link rel="stylesheet" href="css/custom.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section id="home">
					<h1>{{ <span>Twig</span> }}</h1>
					<h2>#dcparis13</h2>
				</section>

        <section>
          <p>
            Cette présentation est <strong>déjà</strong> disponible !!
          </p>
          <p>
            <a href="http://opi.github.io/twig-drupalcamp">opi.github.io/twig-drupalcamp</a>
            <br>
            <a href="https://github.com/opi/twig-drupalcamp">github.com/opi/twig-drupalcamp</a>
          </p>
        </section>

				<section id="menu">
          <h1>Au menu</h1>
					<ul class="discret">
						<li><a href="#/nous">Nous, c'est qui ?</a></li>
            <li><a href="#/twig">Twig, c'est quoi ?</a></li>
            <li><a href="#/drupal-twig">Drupal &amp; Twig, c'est bon ?</a></li>
            <li><a href="#/exemples">Les exemples, c'est quand ?</a></li>
            <li><a href="#/questions">? ? ?</a></li>
					</ul>
				</section>

        <section>
          <section id="nous">
            <h1>Nous, c'est qui ?</h1>
          </section>

          <section>
            <h1>opi</h1>
            <p>
              Développeur &amp; Themeur Drupal
              <br>freelance &amp; NVOS
            </p>
            <ul class="user-links">
              <li><a href="https://drupal.org/user/263678">d.o. #263678</a></li>
              <li><a href="https://twitter.com/opidentica">@opidentica</a></li>
              <li><a href="https://github.com/opi">github.com/opi</a></li>
              <li><a href="http://www.olivierpierre.net">olivierpierre.net</a></li>
            </ul>
          </section>

          <section>
            <h1>Julien D</h1>
            <p>
              Développeur <strike>&amp; Themeur</strike> Drupal
              <br>Commerce Guys
            </p>
            <ul class="user-links">
              <li><a href="https://drupal.org/user/519520">d.o. #519520</a></li>
              <li><a href="https://twitter.com/juliendubreuil">@juliendubreuil</a></li>
              <li><a href="https://github.com/JulienD">github.com/JulienD</a></li>
              <li><a href="http://juliendubreuil.fr/">juliendubreuil.fr/</a></li>
            </ul>
          </section>

        </section>

        <section id="twig">

          <section>
            <h1>Twig, c'est quoi ?</h1>
            <p>Moteur de template PHP</p>
            <p>Par Fabien Potencier, créateur de Symfony</p>
          </section>

          <section>
            <h1>Un peu d'histoire</h1>
            <p>A la base Twig était un moteur de template ecrit en python "Jinja2 " par Armin Ronacher.</p>
            <p>Repris par Fabien Potencier en 2009 pour accomplir son plan de domination du monde.</p>
          </section>

          <section>
            <h1>Comment ca marche ?</h1>
            <p>
              <img src="img/twig_compilation.png" />
            </p>
          </section>

          <section>
            <h1>Les avantages</h1>
            <p>
              <ul>
              <li><b>Extensible</b></li>
              <li><b>Sécurisé:</b> No PHP !</li>
              <li><b>Orienté objet</b></li>
              <li><b>Syntax facile</b></li>
              <li><b>Supporté par les IDEs:</b></li>
              <li><b>Populaire:</b> Zend, CodeIgniter, CakePHP</li>
              <li><b>Bien documenté</b></li>
              <p class="doc"><a href="http://twig.sensiolabs.org/documentation">twig.sensiolabs.org/doc/documentation</a></p>
              <ul>
            </p>
          </section>

          <section>
            <h1>Les incovénients</h1>
            <p>
              <ul>
              <li><b>Nouveau langage à apprendre</b></li>
              <ul>
            </p>
          </section>

          <section>
            <h1>La syntaxe</h1>
            <p>Le caractère important est l'accolade</p>
            <p class="large"><strong>{ }</strong></p>
          </section>

          <section>
            <h2>Les commentaires</h2>
            <pre><code data-trim>
              {# Ici un commentaire #}
            </code></pre>
            <p>A utiliser pour les descriptions et commentaires.</p>
          </section>

          <section>
            <h2>Affichage de variable</h2>
            <pre><code data-trim>
              <h1>{{ title }}</h1>
            </code></pre>
            <p>Équivalent php template:</p>
            <pre><code data-trim>
              <h1>&lt;?php print $title; ?></h1>
            </code></pre>
          </section>

          <section>
            <h2>Plongée dans les variables</h2>
            <pre><code data-trim>
              {{ node.field_description }}
            </code></pre>
            <pre><code data-trim>
              &lt;div {{item.attributes}}&gt;{{ item.data }}&lt;/div&gt;
            </code></pre>
            <p>Peu importe la source (array ou object)</p>
          </section>

          <section>
            <h2>Concaténations de variables</h2>
            <pre><code data-trim>
              {{ "Rédigé par " ~ node.author ~ "." }}
            </code></pre>
          </section>

          <section>
            <h2>Les filtres</h2>
            <pre><code data-trim>
              <h1>{{ title|capitalize }}</h1>
            </code></pre>
            <p>Les filtres sont chainables</p>
            <pre><code data-trim>
              <h1>{{ title|uppercase|nl2br }}</h1>
            </code></pre>
            <p>first, last, lower, upper, join, sort, raw, escape, ...</p>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/filters/index.html">twig.sensiolabs.org/doc/filters</a></p>
          </section>
<!--
          <section>
            <h1>La syntaxe</h1>
            <h2>Les filtres first/last</h2>
            <pre><code data-trim>
{{ [1, 2, 3]|first }} output:1
{{ {a: 1, b: 2, c: 3}|first }} output:1
{{ '123'|first }} output:1
            </code></pre>
            <p>Fonctionne avec les tableaux numériques, associatifs et les chaines</p>
          </section>

          <section>
            <h1>La syntaxe</h1>
            <h2>Filtre d'échappement</h2>
            <pre><code data-trim>
{{ foo|escape }} ou {{ foo|e }}
            </code></pre>
            <p>Contextes d'échappements, HTML par defaut</p>
            <pre><code data-trim>
{{ foo|e }} équivalent à {{ foo|e('html') }}
{{ foo|e('js') }}
{{ foo|e('css') }}
{{ foo|e('html_attr') }}
            </code></pre>
            <p>Échappement automatique</p>
            <pre><code data-trim>
{% autoescape %}
  Tout ce bloc sera échappé {{ foo }}
{% endautoescape %}
            </code></pre>

            <p class="doc"><a href="http://twig.sensiolabs.org/doc/filters/escape.html">twig.sensiolabs.org/doc/filters/escape.html</a></p>
          </section>
-->
          <section>
            <h2>Les fonctions</h2>
            <pre><code data-trim>
              {{ node.created|date("d/m/Y") }}
            </code></pre>
            <p>cycle(), range(), include(), parent(), random(), ...</p>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/functions/index.html">twig.sensiolabs.org/doc/functions</a></p>
          </section>

<!--
          <section>
            <h1>La syntaxe</h1>
            <h2>Nommage des arguments</h2>
            <pre><code data-trim>
{{ "now"|date("d-m-Y", "Europe/Paris") }}
equivalent
{{ "now"|date(format="d-m-Y", timezone="Europe/Paris") }}
            </code></pre>
            <p>Permet de passer qu'un seul argument</p>
            <pre><code data-trim>
{{ "now"|date(timezone="Europe/Paris") }}
            </code></pre>
          </section>
    -->
          <section>
            <h2>Structures de controle</h2>
            <p>if-else condition :</p>
            <pre><code data-trim>
{% if ... %}
{% else %}
{% endif %}
            </code></pre>
            <p>boucle for :</p>
            <pre><code data-trim>
{% for i in 0..10 %}
  {{ i }}
{% endfor %}
            </code></pre>
            <p>For avec condition</p>
            <pre><code data-trim>
{% for user in users if user.active %}
  <span>{{ user.name|e }}</span>
{% endfor %}
            </code></pre>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/tags/index.html">twig.sensiolabs.org/doc/tags</a></p>
          </section>
<!--
          <section>
            <h2>Structures de controle : for</h2>
            <p>Clé / valeur</p>
            <pre><code data-trim>
{% for key, user in users %}
  <span class="user-{{ key }}">{{ user.name|e }}</span>
{% endfor %}
            </code></pre>
            <p>For avec condition</p>
            <pre><code data-trim>
{% for user in users if user.active %}
  <span>{{ user.name|e }}</span>
{% endfor %}
            </code></pre>
          </section>
-->
<!--
          <section>
            <h1>La syntaxe</h1>
            <h2>Structures de controle : for</h2>
            <p>Cas d'un tableau vide</p>
            <pre><code data-trim>
{% for user in users %}
  <span>{{ user.name|e }}</span>
{% else %}
  <span class="empty">No user found</span>
{% endfor %}
            </code></pre>
          </section>

          <section>
            <h1>Les tests</h1>
            <pre><code data-trim>
{% if foo is empty %}
  <span>Empty</span>
{% endif %}
            </code></pre>
            <pre><code data-trim>
{% if foo is defined %}
{% endif %}
            </code></pre>
          </section>

          <section>
            <h1>Math &amp; Logic</h1>
            <pre><code data-trim>{{ 1 + 1 }}</code></pre>
            <pre><code data-trim>{{ 2 * 5 }}</code></pre>
            <pre><code data-trim>{{ 20 // 7 }} {# returns 2 #}</code></pre>
            <pre><code data-trim>{% if foo and bar %}</code></pre>
            <pre><code data-trim>{% if foo or bar %}</code></pre>
            <pre><code data-trim>{% if foo in [1, 2, 3] %}</code></pre>
            <pre><code data-trim>{% if foo not in [1, 2, 3] %}</code></pre>
            <pre><code data-trim>{{ foo ? 'yes' : 'no' }}</code></pre>
            <p></p>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/templates.html#math">twig.sensiolabs.org/doc/templates.html#math</a></p>
          </section>
-->
          <section>
            <h2>Inclure un template dans un template ("templatception")</h2>
              <pre><code data-trim>
{% block body %}
  <h1>Recent Articles</h1>
  {% include 'articles.html' %}
{% endblock %}
            </code></pre>
            <p>Inclusion de template via la balise {% include %}</p>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/templates.html#including-other-templates">twig.sensiolabs.org/doc/templates.html#including-other-templates</a></p>
          </section>
<!--
          <section>
            <h2>Macros</h2>
          </section>
-->
          <section>
            <h2>Eténdre et surcharger un template</h2>
            <p>base.html</p>
            <pre><code data-trim>
<head>
  {# base.html #}
  {% block head %}
    <title>{% block title %}{% endblock %} - My Webpage</title>
  {% endblock %}
</head>
            </code></pre>
            <p>index.html</p>
            <pre><code data-trim>
<head>

{% extends "base.html" %}

{% block title %}Index{% endblock %}
{% block head %}
    {{ parent() }}
    <style type="text/css">
        .important { color: #336699; }
    </style>
{% endblock %}
</head>
            </code></pre>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/templates.html#template-inheritance">twig.sensiolabs.org/doc/templates.html#template-inheritance</a></p>
          </section>

          <section>
            <h2>Extensions</h2>
            <p>
              Permet d'ajouter ses propres tag, filtres &amp; fonctions
            </p>
            <pre><code data-trim>
&lt;?php
$filter = new Twig_SimpleFilter('spip2drupal', function ($string) {
    return str_replace('spip', 'drupal', $string);
});
            </code></pre>
            <pre><code data-trim>
              {{ node.body|spip2drupal }}
            </code></pre>
            <p class="doc"><a href="http://twig.sensiolabs.org/doc/extensions/index.html">twig.sensiolabs.org/doc/extensions/index.html</a></p>
          </section>


        </section>

        <section id="drupal-twig">
          <section>
            <h1>Drupal &amp; Twig,<br> c'est bon ?</h1>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Pourquoi ?</h2>
            <p>
              Plusieurs raisons ont menées à la <strong>frustration</strong> des themeurs
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>#1 Mixed data type</h2>
            <p>
              <b>D7</b> : Rien de normé, on peut manipuler du texte, des tableaux ou encore de objets
              <br>
              $node->nid || $page['content']
            </p>
            <p>
              <b>Twig</b> : Tout est normé. Chaque variable est accessible de la même facon
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>#2 Methodes d'affichage</h2>
            <p>
              <b>D7</b> : print($variables); ou print render($variables);
            </p>
            <p>
              <b>Twig</b> : {{ variables }} suffit et évite les erreurs
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>#3 Surcharge du markup</h2>
            <p>
              <b>D7</b> : Fonctions de theme ou templates
            </p>
            <p>
              <b>Twig</b> : Tout devient un template .html.twig
            </p>
            <p>
              node.tpl.php >>  node.html.twig
              <br>
              theme_table() >> tables.html.twig
              <!-- // TODO check with Jen if it's in core now ? -->
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>#4 Manque de sécurité</h2>
            <p>
              <b>D7</b> : Tout est accessible tel quel et rien n'est filtré par défaut.
              Pas de sanitization.
            </p>
            <p>
              <b>Twig</b> : Escape automatique et si vous voulez quelque chose de non sécurisé, il faut le vouloir :)
              <br>
              La plupart des fonctions php ne sont pas executable ! Fini les requetes SQL dans les templates !
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Inconvenients</h2>
            <p>
              Nouvelle syntaxe à apprendre
              <br>
              Migration pour les mainteneurs de modules
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Avantages</h2>
            <p>
              Tout dans des templates (.html.twig)
              <br>
              Syntaxe plus simple &amp; lisible
              <br>
              =
              <br>
              Travail plus simple pour les themeurs
            </p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Filtre t</h2>
            <p>
              Remplace t()
            </p>
            <pre><code data-trim>
{{ "Read more" | t }}
            </code></pre>
            <pre><code data-trim>
{% set time = node.created | date("d/m/Y") %}
{{ "Published on @time" | t({'@time' : time}) }}
            </code></pre>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Fonctions</h2>
            <p>
              hide() / show()
            </p>
            <p>Fonctionnement identique à Drupal 7</p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Debug</h2>
            <p>Dans les fichiers de templates .html.twig</p>
            <pre><code data-trim>
              {{ dump() }}
            </code></pre>
            <p><em>
              Équivalent de var_dump(get_defined_vars());
            </em></p>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Debug</h2>
            <p>Dans settings.php</p>
            <pre><code data-trim>
              $settings['twig_debug'] = TRUE;
            </code></pre>
            <p>
              Source avec commentaires détaillés (= devel_themer)
            </p>
            <pre class="long"><code data-trim>
<!-- THEME DEBUG -->
<!-- CALL: theme('block') -->
<!-- FILE NAME SUGGESTIONS:
  * block--system.html.twig
  * block--system-main-block.html.twig
  * block--content.html.twig
  x block.html.twig-->
<!-- BEGIN OUTPUT from 'core/modules/block/templates/block.html.twig' -->
<div class="block block-system" id="block-content">
...
            </code></pre>
          </section>

          <section>
            <h1>Drupal &amp; Twig</h1>
            <h2>Debug</h2>
            <p>Dans settings.php</p>
            <p>Recompilation des templates à chaque changements</p>
            <pre><code data-trim>
              $settings['twig_auto_reload'] = TRUE;
            </code></pre>

            <p>Désactivation du cache des templates Twig</p>
            <pre><code data-trim>
              $settings['twig_cache'] = FALSE;
            </code></pre>
          </section>

        </section>


        <section id="exemples">
          <section>
            <h1>Les exemples,<br> c'est quand ?</h1>
          </section>
        </section>

        <section id="questions">
          <section>
            <h1>? ? ?</h1>
          </section>
        </section>

        <section>
          <section>
            <h1>{% end %}</h1>
          </section>
        </section>

			</div>

      <footer id="footer">
        <a href="#/home" class="discret">Twig &amp; Drupal</a> - DrupalCamp Paris 2013 - opi &amp; JulienD
      </footer>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

        rollingLinks: false,

				// theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					// { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					// { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
